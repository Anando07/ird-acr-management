<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>User List</title>

    <meta charset="utf-8">

    <link href="//netdna.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/bootstrap.min.css" th:href="@{/css/bootstrap.min.css}" rel="stylesheet"/>
    <script type="text/javascript" th:src="@{/js/jquery.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/bootstrap.min.js}"></script>
    <link href="../css/jquery.dataTables.min.css" th:href="@{/css/jquery.dataTables.min.css}" rel="stylesheet"/>
    <script type="text/javascript" th:src="@{/js/jquery.dataTables.min.js}"></script>

    <script>
        $(function () {
            $("#userTable").DataTable();
        });
    </script>

    <script th:if="${existRoll != null}">
        $(function () {
            $('#myModal').modal('show');

            $("body").on("hidden.bs.modal", function () {
                window.location.href = window.location.origin + "/admin/userList";
            });
        });
    </script>


</head>

<body style="padding-top: 40px; padding-bottom: 3px;  background-repeat: no-repeat;
 background-size: cover;" background="../images/background4.jpg">

<div class="container" style="width: 70%">
    <div th:replace="fragment/menuBar :: menubar"></div>
    <div th:replace="fragment/slider :: slider"></div>

    <h2 style="text-align:center;color:green">User Information</h2>
    <hr/>
    <div style=" display: block; padding: 10px; margin-bottom: 30px; text-align: justify; background-color: #F0F8FF">
        <div style="width: 90%" class="center">
            <table id="userTable" class="table table-striped table-bordered">
                <thead>
                <tr>
                    <th style="text-align:center;">Name</th>
                    <th style="text-align:center;">User Id</th>
                    <th style="text-align:center;">Designation</th>
                    <th style="text-align:center;">Phone</th>
                    <th style="text-align:center;">Role</th>
                    <th style="text-align:center;">Setting</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="user : ${userlist}">
                    <td th:text="${user.name}" align="center"></td>
                    <td th:text="${user.userId}" align="center"></td>
                    <td th:text="${user.designation}" align="center"></td>
                    <td th:text="${user.phone}" align="center"></td>
                    <td th:text="${user.roleType}" align="center"></td>

                    <td align="center">
                        <button type="button"
                                class="btn btn-info btn-md" data-toggle="modal" data-target="#myModal"
                                th:onclick="'getUser(\'' + ${user.id} + '\');'">Edit
                        </button>



                        <a th:href="@{/admin/deleteUser(userId=${user.userId})}"
                           onclick="return confirm('Are you sure you want to delete this item?');">
                            <button type="button"
                                    class="btn btn-info btn-md">Delete
                            </button>
                        </a>

                    </td>

                </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div th:replace="fragment/footer :: footer"></div>
</div>

<div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog" th:fragment="updateForm">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-body">


                <!-- Form Name -->
                <legend>Update User</legend>

                <form class="form-horizontal" action="#" th:action="@{/admin/doUpdate}"
                      th:object="${user}" method="post">
                    <fieldset>

                        <div class="form-group">
                            <label class="col-md-4 control-label" for="name">Name</label>
                            <div class="col-md-4">

                                <input id="id" path="id" name="id" type="hidden" th:field="*{id}">

                                <input id="name" path="name" name="name" type="text"
                                       placeholder="Name" class="form-control input-md"
                                       th:field="*{name}" required>


                            </div>
                        </div>


                        <!-- Text input-->
                        <div class="form-group">
                            <label class="col-md-4 control-label" for="userId">User ID</label>
                            <div class="col-md-4">
                                <input id="userId" path="userId" name="userId"
                                       type="text" placeholder="userId"
                                       class="form-control input-md" th:field="*{userId}" required
                                >
                                <span th:if="${existRoll !=null}"
                                      style="color:Red;"> User with this Id is already Exist !</span>
                            </div>
                        </div>
                        <!-- Text input-->
                        <div class="form-group">
                            <label class="col-md-4 control-label" for="designation">Designation
                            </label>
                            <div class="col-md-4">
                                <input id="designation" path="designation" name="designation"
                                       type="text" placeholder="designation"
                                       class="form-control input-md"
                                       th:field="*{designation}">
                            </div>
                        </div>

                        <!-- Text input-->
                        <div class="form-group">
                            <label class="col-md-4 control-label" for="phone">Phone
                            </label>
                            <div class="col-md-4">
                                <input id="phone" path="designation" name="phone"
                                       type="text" placeholder="phone"
                                       class="form-control input-md"
                                       th:field="*{phone}">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-md-4 control-label" for="roleId">Role</label>

                            <div class="col-md-4">
                                <select id="roleId" name="roleId" class="form-control" th:field="*{roleId}">
                                    <option value=1>ADMIN</option>
                                    <option value=2>OPERATOR</option>
                                    <!--<option value=3>USER</option>-->
                                </select>
                            </div>

                        </div>

                        <!-- Button -->
                        <div class="form-group">
                            <label class="col-md-4 control-label" for="register"></label>
                            <div class="col-md-4">
                                <button id="register" name="register" class="btn btn-primary">
                                    Update
                                </button>
                            </div>
                        </div>

                    </fieldset>
                </form>

            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>


</div>

<script th:inline="javascript">

    function getUser(id) {
        $.ajax({
            type: 'get',
            url: /*[[ @{'/admin/getUser'} ]]*/,
            data: {id: id},
            success: function (returnedData) {
                console.log(returnedData);
                $('#myModal').html(returnedData);

                $('#myModal').modal('show');

            }
        });
    }
</script>
</body>
<style>
    .center {
        margin: auto;
        width: 60%;

        padding: 10px;
    }
</style>
</html>